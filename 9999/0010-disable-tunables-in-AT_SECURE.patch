From 5d1686416ab766f3dd0780ab730650c4c0f76ca9 Mon Sep 17 00:00:00 2001
From: Gleb Fotengauer-Malinovskiy <glebfm@altlinux.org>
Date: Wed, 20 Sep 2023 05:00:00 +0000
Subject: [PATCH] elf/dl-tunables.c: avoid processing of tunables in AT_SECURE executables

Complements: owl-alt-sanitize-env
---
 elf/dl-tunables.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/elf/dl-tunables.c b/elf/dl-tunables.c
index 62b7332..e5e9093 100644
--- a/elf/dl-tunables.c
+++ b/elf/dl-tunables.c
@@ -274,6 +274,9 @@ __tunables_init (char **envp)
   size_t len = 0;
   char **prev_envp = envp;
 
+  if (__glibc_unlikely (__libc_enable_secure))
+    return;
+
   maybe_enable_malloc_check ();
 
   while ((envp = get_next_env (envp, &envname, &len, &envval,
-- 
1.7.3.3

