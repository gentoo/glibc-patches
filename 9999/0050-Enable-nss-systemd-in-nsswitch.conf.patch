From eab439ef67e7749f0e0a159e373e54b5f4dbe887 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20K=2E=20H=C3=BCttel?= <dilfridge@gentoo.org>
Date: Sat, 27 Feb 2021 18:37:33 +0100
Subject: [PATCH] Enable nss-systemd in nsswitch.conf
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

See
https://bugs.gentoo.org/768366
https://www.freedesktop.org/software/systemd/man/nss-systemd.html

Bug: https://bugs.gentoo.org/768366
Signed-off-by: Andreas K. HÃ¼ttel <dilfridge@gentoo.org>
---
 nss/nsswitch.conf | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/nss/nsswitch.conf b/nss/nsswitch.conf
index 40030d1dd7..0faf5e71fe 100644
--- a/nss/nsswitch.conf
+++ b/nss/nsswitch.conf
@@ -50,17 +50,24 @@
 # shadow:    db files
 # group:     db files
 
+# If you encounter slowdowns of file operations and do not use
+# systemd-generated users and groups, you can disable the corresponding
+# lookups by replacing the group and passwd lines with, e.g.,
+# group:    files
+# passwd:   files
+# See also https://bugs.gentoo.org/773436
+
 # In alphabetical order. Re-order as required to optimize peformance.
 aliases:    files
 ethers:     files
-group:      files
+group:      files [SUCCESS=merge] systemd
 gshadow:    files
 hosts:      files dns
 # Allow initgroups to default to the setting for group.
 # initgroups: files
 netgroup:   files
 networks:   files dns
-passwd:     files
+passwd:     files systemd
 protocols:  files
 publickey:  files
 rpc:        files
-- 
2.26.3

